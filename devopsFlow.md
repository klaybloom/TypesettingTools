# WeChat Typesetting Tool 开发流程记录

> 开发周期: 2026-02-04 ~ 2026-02-05
> 项目: 公众号排版工具 (TypeSetting)

---

## 📋 项目概述

WeChat Typesetting Tool 是一款面向微信公众号的 AI 排版工具，支持 Markdown 语法，提供实时预览和一键复制功能。

---

## 🔄 开发迭代记录

### 第一阶段：基础功能实现

| 任务 | 状态 | 说明 |
|-----|------|-----|
| 项目初始化 | ✅ | Vue 3 + Vite 搭建 |
| 编辑器组件 | ✅ | Markdown 输入区域 |
| 预览组件 | ✅ | 手机端/桌面端切换 |
| 样式面板 | ✅ | 字体、颜色、间距调整 |
| 格式化引擎 | ✅ | Markdown → HTML 转换 |

---

### 第二阶段：编辑器稳定性修复

**问题**: `contenteditable` div 存在严重的光标定位和输入问题

**症状**:
- 光标跳动不稳定
- 换行处理异常
- 中文输入法 (IME) 兼容性差
- 文本插入位置不准确

**解决方案**:
```
contenteditable div → 原生 textarea 元素
```

**效果**: 彻底解决光标和输入稳定性问题

---

### 第三阶段：Markdown 功能扩展

#### 工具栏增强

**新增按钮**:
- H1/H2/H3 标题
- 粗体 / 斜体
- 引用 / 列表
- 代码 / 代码块
- 表格 / 链接
- 分割线 / 待办事项

#### 格式化引擎更新 (`formatter.js`)

| 功能 | 语法 | 渲染效果 |
|-----|------|---------|
| 代码块 | ` ``` ` | 深色背景 + 等宽字体 |
| 行内代码 | `` `code` `` | 高亮背景 |
| 表格 | `\| 列 \| 列 \|` | 带边框表格 |
| 待办 | `- [ ]` / `- [x]` | 复选框样式 |
| 分割线 | `---` | 水平线 |
| 斜体 | `*text*` | 斜体文字 |

---

### 第四阶段：表格和分割线修复

**问题**: `---` 被转换为中文破折号 `——`

**根因**: `punctuation.js` 中的 `normalizeDash()` 函数

**修复**:
```javascript
// 跳过独立一行的 --- 和表格分隔行
if (/^[-*_]{3,}$/.test(trimmed)) return line
if (/^\|.*\|$/.test(trimmed) && trimmed.includes('---')) return line
```

---

### 第五阶段：工具栏紧凑化

**改动**:
- 主要按钮精简为图标形式
- 次要功能收入 "更多" 下拉菜单
- 单行显示，节省空间

**布局**:
```
⋮ | H | B | I | 引用 | 列表 | 代码 | 分割线
```

---

### 第六阶段：UI 简化

#### Header 优化
- 移除副标题 "公众号 AI 排版工具"
- Logo 和按钮改为黑白灰配色

#### 区域标题
- "输入原文" → "输入"
- "排版预览" → "预览"
- 高度缩小，左右对齐

#### 样式面板
- 移除右侧悬浮按钮
- 点击页面任意位置关闭面板

---

## 🛠 技术栈

| 类别 | 技术 |
|-----|------|
| 框架 | Vue 3 (Composition API) |
| 构建 | Vite |
| 语言 | JavaScript, HTML, CSS |
| 特性 | 响应式设计, 主题切换 |

---

## 📁 项目结构

```
TypesettingTools/
├── src/
│   ├── App.vue              # 主应用
│   ├── components/
│   │   ├── Editor.vue       # 编辑器 + 工具栏
│   │   ├── Preview.vue      # 预览区域
│   │   └── StylePanel.vue   # 样式设置面板
│   ├── utils/
│   │   ├── formatter.js     # Markdown 格式化引擎
│   │   └── punctuation.js   # 标点符号规范化
│   └── styles/
│       ├── base.css         # 基础样式
│       └── variables.css    # CSS 变量
└── index.html
```

---

## 📸 开发截图

### 最终 UI
![最终界面](/Users/bloom/.gemini/antigravity/brain/f158882f-e8b2-4e55-bf27-cf0a2fe10767/initial_ui_state_1770261013232.png)

### 紧凑工具栏
![工具栏](/Users/bloom/.gemini/antigravity/brain/f158882f-e8b2-4e55-bf27-cf0a2fe10767/compact_toolbar_dropdown_open_1770259863819.png)

### 格式化效果
![预览效果](/Users/bloom/.gemini/antigravity/brain/f158882f-e8b2-4e55-bf27-cf0a2fe10767/preview_bottom_check_1770258890516.png)

---

## ✅ 完成功能清单

- [x] Markdown 实时预览
- [x] 手机端/桌面端切换
- [x] 深色/浅色主题
- [x] 一键复制到公众号
- [x] 自定义样式设置
- [x] 紧凑工具栏 + 下拉菜单
- [x] 表格、代码块、待办事项支持
- [x] 点击外部关闭面板

---

## 🐛 已修复问题

1. **编辑器光标跳动** → 改用 textarea
2. **表格分隔行显示为内容** → 正则匹配跳过
3. **分割线变成破折号** → punctuation.js 保留 Markdown 语法
4. **悬浮按钮遮挡** → 移除悬浮按钮
5. **面板关闭不便** → 点击任意处关闭

---

*Generated by Claude / Antigravity - 2026-02-05*
